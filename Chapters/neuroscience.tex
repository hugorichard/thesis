In the previous chapter, we introduced some background on statistics and
optimization.
In this chapter, we present the necessary background on the data used in this
thesis.
In our experiments we use functional-resonance imaging (fMRI) or
magnetoencephalograpy (MEG) data. As will be seen in this chapter, these two modalities have very different
characteristics.

\section{Functional magnetic resonance imaging (fMRI)}
This section is heavily inspired by the handbook of
Poldrack~\cite{poldrack2011handbook}.

\subsection{The BOLD signal and hemodynamic response}
The story of fMRI begins with the discovery of the blood-oxygen-level-dependent
(BOLD) imaging discovered in 1990 by Ogawa~\cite{ogawa1990brain}. When neurons
fire, they consume oxygen and therefore, the level of oxygen in blood changes.
Since oxygenated and deoxygenated blood (oxyhemoglobin
and deoxyhemoglobin) do not have the same magnetic susceptibility, changes in
the oxygen level in blood can be tracked by a magnetic resonance imaging (MRI) scanner.

When a short stimuli occur, the change in the relative change in the MRI signal (BOLD
signal) is not instantaneous. The typical response to a stimuli follows the
curve displayed in figure~\ref{fig:hrf}. This response is rather slow (it may lats \emph{20s}) compared to the temporal scale of neurons which is on the order of \emph{ms}.
Luckily, the shape of the hemodynamic response does not vary much across time
and therefore the BOLD signal is often seen as the result of the convolution of activation with the hemodynamic response.

\subsection{Spatial and temporal resolution of fMRI data}
In our view, the success of fMRI is due to its advantages compared to positron
emission topography (PET) that uses radioactive tracers to follow glucose or water levels.
While PET has a spatial resolution of a few
centimeters, fMRI has a spatial resolution of a few millimeters. As a result, a voxel in an fMRI image typically encompass several hundreds thousands of neurons.
In addition, while taking an image with PET takes about a minute, it takes on the order of 2s to produce an fMRI image.
Lastly, fMRI is safe and does involve being exposed to radioactive tracers as in PET.

\subsection{Experimental designs}
In \emph{resting state} fMRI, subjects are instructed to lie still in the scanner without further instruction.
These kind of data can be used to extract networks that highlight the regions that tend to co-activate.
This contrasts with \emph{task} fMRI, where subjects have specific instructions.
In task fMRI, two types of experimental design are widespread.
Bloc designs are widespread designs particularly suited to modalities with low temporal resolutions (such as PET). In bloc designs, subjects are exposed to continuous stimuli that last of a rather long period of time before it switches to another.
This contrasts with event related designs that are only suited to modalities with a short enough time resolution. In event related design, a sequence of short event are presented and separated by a time window (inter-stimulus interval).
When the inter-stimulus interval is shorter than the length of the hemodynamic response, we talk about ``fast'' even related designs.
Lastly, in \emph{naturalist fMRI}, subjects are instructed to watch a movie
or listen to an audio track. Such kind of stimuli are called \emph{naturalistic stimuli} and constitue a middle ground between resting state and task fMRI as activations are time locked while the environment is not as controlled as in a typical task fMRI setting.
In this thesis, we use mostly \emph{naturalistic fMRI} to benchmark our methods.

\subsection{Preprocessing}
The fMRI signal is particularly noisy. Several techniques are used to reduce the noise and enhance the quality of the data.

\subsubsection{Distortion correction}
In the MRI scanner, a constant magnetic field is applied. However, in areas
where air and tissue meet, the magnetic field is distorted leading to errors in
the localization of voxels near the sinus or ears. However, most scanners come
with a map quantifying the distance that each voxel has been shifted. By
inverting the map, we can recover the correct location of voxels.


\subsubsection{Slice timing correction}
Images are acquired in slices, one slice at a time so that different voxels are acquired at different times.
In order to correct for this effect, a reference slice is chosen and other slices are interpolated so that all the voxels can be considered to have been acquired at the same time. 

\subsubsection{Motion correction}
Head motion causes massive distortion of the signal. They are corrected by chosen a reference image and apply rigid body transformations so that other images match the orientation and localization of the reference image.

\subsubsection{Spatial smoothing}
Spatial smoothing blurs the image by application of a Gaussian kernel with a given width (in mm). When the signal of interest has a large spatial extend, smoothing increase the signal to noise ratio. 
Smoothing is also used as a way to decrease between subject variability.
However, in our experiment, we usually don't apply smoothing as our methods are able to deal with subject variability without having to discard higher frequencies.

\subsubsection{Spatial normalization}
Each subject has a brain of different size and of different shape.
The goal of spatial normalization is to align the subjects in order to reduce anatomical variability.
The most widespread technique is to align all images on a template image. The
template image used is based on an atlas developed at the Montreal Neurological
Institute (MNI atlas) where 305 images were aligned based on anatomical features, averaged and then re-aligned to the mean image based on an affine registration model.
Then an affine linear registration is applied. Typically, fMRI images of each subject are aligned on a high dimensional anatomical image of the same subject (this step is called \emph{coregistration}) and then the anatomical image is aligned to the MNI atlas. The two transformations are then composed to project fMRI data to the MNI space.

\subsection{Analyzing task fMRI data via the general linear model}
In this section, we describe one the most popular framework for analyzing fMRI data known as the general linear model.










\subsection{Preprocessing}


This technique is now widely used 



Task fMRI:
As a non-invasive brain imaging technique, task fMRI records brain
activity while participants are
performing specific cognitive tasks.

\subsection{Principle}
\begin{itemize}
\item 1990 Ogawa observed BOLD effect
\item 1992 First images in Human
  \item Blood need energy (sugar oxygen) quickly, Blood releases oxygen that is
    not consumed (hemodynamic repsonse) Deoxyhemoglobin produces distortion of
    the magnetic field. Peaks after 5s.
  \item Block designs
  \item Resting state
    \item Naturalistic stimuli
\end{itemize}
\subsection{Pre-processing}
\begin{itemize}
\item Slice time correction
\item Spatial re-alignment
\item Coregistration to the T1 image
\item Affine transformation of the functional volumes to a template brain (MNI)
\end{itemize}
\subsection{fMRI Datasets}
\label{srm:datasets:fmri}
In this subsection we provide examples of fMRI datasets. These datasets will be
used to evaluate the methods developed in this thesis.
Datasets are preprocessed with FSL \url{http://fsl.fmrib.ox.ac.uk/fsl} using slice time correction, spatial realignment, coregistration to the T1 image and affine transformation of the functional volumes to a template brain (MNI).
Using Nilearn \cite{abraham2014machine}, preprocessed data are resampled, masked
(using a full brain mask available at \url{http://cogspaces.github.io/assets/data/hcp_mask.nii.gz}), detrended and standardized.

In the \emph{SHERLOCK} dataset, 17 participants are watching "Sherlock" BBC TV show (episode 1). 
% 
These data are downloaded from \url{http://arks.princeton.edu/ark:/88435/dsp01nz8062179}. 
% 
Data were acquired using a 3T scanner with an isotropic spatial resolution of 3 mm. 
% 
More information including the preprocessing pipeline is available in \cite{sherlock}.
% 
Subject 5 is removed because of missing data leaving us with 16 participants.
% 
Although SHERLOCK data contains originally only 1 run, we split it into 4 blocks of 395 timeframes and one block of 396 timeframes for the needs of our experiments. 

In the \emph{FORREST} dataset, 20 participants are listening to an audio version of the movie Forrest Gump.
% 
FORREST data are downloaded from OpenfMRI~\cite{poldrack2013toward}. 
% 
Data were acquired using a 7T scanner with an isotropic spatial resolution of 1 mm (see more details in \cite{hanke2014high}.
% 
More information about the forrest project can be found at \url{http://studyforrest.org}.
% 
Subject 10 and run 8 are discarded because of missing data.
% 
We therefore use full brain data of 19 subjects split in 7 runs of respectively 451, 441, 438, 488, 462, 439 and 542 timeframes.


In the \emph{CamCAN} dataset, 647 participants aged from 18 to 88 years are watching Alfred Hitchcock's "Bang! You're Dead" (edited so that it lasts only 8 minutes).
% 
CamCAN consists of data obtained from the CamCAN repository (available at \url{http://www.mrc-cbu.cam.ac.uk/datasets/camcan/}) (see \cite{taylor2017cambridge} and \cite{shafto2014cambridge}).
% 
We use all available subjects and runs yielding 647 participants and 1 run of 193 timeframes.


The \emph{RAIDERS} dataset reproduces the protocal described
in~\cite{haxby2011common}. 10 participants are watching the movie "Raiders
of the lost ark". This dataset pertains to the Individual Brain Charting
dataset~\cite{ibc}.
% 
Data 
% 
We use full brain data of 10 subjects split in 9 runs of respectively 374, 297, 314, 379, 347, 346, 350, 353 and 211 timeframes.
%
Note that the Raiders dataset is different from the one used in~\cite{chen2015reduced}, as it involves different subjects, and because data were acquired at NeuroSpin using a 3T scanner with an isotropic spatial resolution of 1.5 mm.
The \emph{raiders-full} dataset~\cite{ibc} is an extension of the \emph{raiders} dataset where the first two scenes of the movie are shown twice (130 mins).

The CLIPS dataset reproduces the protocol of original studies described in
\cite{nishimoto2011reconstructing} and \cite{huth2012continuous}. 10
participants are exposed to short clips. The data were acquired in 17 runs of 325 timeframes. 
%
The CLIPS dataset also pertains to the Individual Brain Charting dataset
(\cite{ibc}).
%
At the time of writing, the CLIPS and RAIDERS dataset from the individual brain charting dataset \url{https://project.inria.fr/IBC/} are not yet public, but they will be in the future. Protocols on the visual stimuli presented are available in a dedicated repository on Github: \url{https://github.com/hbp-brain-charting/public_protocols}.

Unless stated otherwise we use spatially unsmoothed data, except for the
\emph{sherlock} dataset, for which the available data are already preprocessed
with a 6\,mm spatial smoothing. All datasets are built from successive
acquisitions called \emph{runs}. The repetition time (TR) is 2s for all datasets
except for the Sherlock dataset where the TR is 1.5s.
%

A summary about the size of each dataset is available in Table~\ref{tab:dataset_desc2}.
\begin{table}
	\begin{tabular}{|c|c|c|c|c|}
		\hline
		\textbf{Dataset} & \textbf{Subjects} & \textbf{Runs} & \textbf{Average run} & \textbf{Voxels} \\
                     && & \textbf{length} & \textbf{(per subject)} \\
                     && & \textbf{(in timeframes)} &  \\
                     &$m$& $ $ & $n$ &$v$  \\
		\hline
		CLIPS & 10 & 17 & 325 & 212445\\ 
		\hline
		SHERLOCK & 16 & 5 & 395 & 212445 \\ 
		\hline
		RAIDERS & 10 & 9 & 330 & 212445 \\
		\hline 
		FORREST & 19 & 7 & 465 & 212445\\
		\hline
		CamCAN & 647 & 1 & 193 & 212445 \\
		\hline
	\end{tabular}
  \caption{\textbf{Datasets description}}
  \label{tab:dataset_desc2}
\end{table}
\subsection{A classical supervised experimental setting to map brain functions}
\subsubsection{Block design}
Describe block design setting and GLM model
\subsubsection{GLM model}
Univariate statistical methods, such as general linear models (GLMs)
\cite{friston1995analysis} have been successfully applied to
identifying the brain regions involved in specific tasks.
% 
Describe seed based resting state as well as atlas based resting state.

\subsubsection{Decoding}
However such methods do not capture well correlations and interactions between brain-wide measurements.
By contrast, classifiers trained 
to \emph{decode} brain maps, i.e to discriminate between specific stimulus or task types~\cite{shirer_decoding_2012,varoquaux_how_2014,loula_decoding_2018}, take these correlations into account. 
% 
The same framework is also popular for individual imaging-based diagnosis.

% 
\subsection{An example of unsupervised design: analysis of resting state data}

\section{Magneto electro encephalography (MEG)}
\subsection{Principle}
History
\begin{itemize}
  \item EEG: 1929 Hans Berger developed electroencephalograpgy, the grapgic
    representation of the difference in voltage between towo different cerbral
    locations plotted over time. (Electrical potential difference)
    \item 1972: David Cohen invented magneto encephalography. This measurement
      takes advantage of the direct connection between electrical activity and
      magnetism. (Magnetic field generated by neural activity)

      \item When a group of neuron (50 000~100 000) is simulatenously excited, it generates a current
      of large enough magnitude to be captured by EEG/MEG
    \item Artifacts: signals not generated by the brain. Cleaning the data two types: physiological ones (eye movement (blinking), muscal artefact
      (squizing teath)), non physiological ones (cell phone) 
     \item Forward problem: measurement of the current from the sources (rather
       easy). Model electrical condution of human head.  Difficult problem is to
       find the sources from the MEG/EEG (inverse problem). More possible
       solutions for sources than number of electrodes.
       Making reasonnable guess on sources. No unique solution.

     \item Signal neads to pass protective layers (becomes weaker). We have
       active electrodes with amplifiers inside or passive that is amplified
       only later (EEG)
     \item MEG: SQUID (measuring very weak magnetic fields) and applify a few centimers away from the sensors.
      
\end{itemize}
\subsection{Preprocessing}
Predefined distance from the screen, and for a predifined task. Blank screen in
between stimulus. Phase lock activity  is generated. Average across trials = ERP
(event related potential). Positive deflection P100.
Good temporal resolution bad spatial resolution.
Stimulation can be shown continuously. We then present a stimulkus flickering at
a specific frequency.
\subsection{Source localization: forward and inverse models}
Talk about how source localization is done in MEG. Insist on the fact that it is
rather slow so that in the next section we can make the link with ICA
\subsection{MEG datasets}
\label{sec:meg:datasets}
In this section, we give example of MEG datasets. These examples are used in
the rest of the thesis to evaluate the methods developed.

The \emph{Sinusoidal Phantom MEG} dataset uses data collected with a realistic head phantom, which is a plastic device mimicking real electrical brain components.
% 
Eight current dipoles positioned at different locations can be switched on or off.
% 
We only consider the 102 magnetometers.
% 
An epoch corresponds to 3\,s of MEG signals where a dipole is switched on for 0.4\,s with an oscillation at 20\,Hz and a peak-to-peak amplitude of 200\,nAm.
% 
We have access to $100$ epochs per dipole.

The \emph{CamCAN} dataset contains the MEG data of 647 different subjects
exposed to an audio-visual stimuli. 
